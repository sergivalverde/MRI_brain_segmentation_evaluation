MACRO(SUBDIRLIST result curdir)
  FILE(GLOB children RELATIVE ${curdir} ${curdir}/*)
  SET(dirlist "")
  FOREACH(child ${children})
    IF(IS_DIRECTORY ${curdir}/${child})
    	LIST(APPEND dirlist ${child})
    ENDIF()
  ENDFOREACH()
  SET(${result} ${dirlist})
ENDMACRO()

MACRO(DIRMATCHING result baseDir regExp)
	SUBDIRLIST(SUBDIRS ${baseDir})
	FOREACH(subdir ${SUBDIRS})
	    set(curdir "${baseDir}/${subdir}")
		if(curdir MATCHES ${regExp} )
			list(APPEND result ${curdir})
		endif()
	ENDFOREACH()
ENDMACRO()

MACRO(DIRSMATCHING result baseDirs regExp)
	FOREACH(aBaseDir ${${baseDirs}})
	string(REPLACE  "("   "\\\\("   baseRegExp  ${aBaseDir})
	string(REPLACE  ")"   "\\\\)"   baseRegExp  ${baseRegExp})
	    DIRMATCHING(interRes ${aBaseDir} "${baseRegExp}/${regExp}")
		FOREACH(aRes ${interRes})
			if(curdir MATCHES ${regExp} )
				list(APPEND result aRes)
			endif()
		ENDFOREACH()
	ENDFOREACH()
ENDMACRO()

MACRO(GETFIRSTELEM res inLst)
	list(LENGTH ${inLst} nbElem)
	if(nbElem GREATER 0)
		list(GET ${inLst} 0 ${res})
	endif()
ENDMACRO()